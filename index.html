<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Game - Mobile Edition</title>
    <style>
        /* CSS GERAL */
        :root {
            /* Cores Padr√£o (Modo Escuro) */
            --bg-body: #0f0f23;
            --bg-screen: #1a1a2e;
            --bg-menu-btn: #2a2a3a;
            --color-primary: #5865F2;
            --color-primary-rgb: 88, 101, 242; /* RGB para efeitos de transpar√™ncia */
            --color-text: white;
            --color-subtle: #666;
            --color-border: #3a3a4e;
        }

        /* MODO CLARO - As cores ser√£o invertidas */
        .light-mode {
            --bg-body: #f0f0f5;
            --bg-screen: #ffffff;
            --bg-menu-btn: #e0e0e8;
            --color-primary: #4CAF50; /* Verde mais suave para o claro */
            --color-primary-rgb: 76, 175, 80;
            --color-text: #1a1a2e;
            --color-subtle: #888;
            --color-border: #cccccc;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: var(--bg-body);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: 'Courier New', monospace;
            overflow: hidden; 
            color: var(--color-text);
        }
        
        /* TELA DO MENU */
        .menu-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center;
        }
        .menu-screen h1 {
            color: var(--color-primary);
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(88, 101, 242, 0.5);
        }
        
        .light-mode .menu-screen h1 {
            text-shadow: 0 0 10px rgba(76, 175, 80, 0.5); /* Sombra verde */
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 300px;
        }
        
        .menu-btn {
            background: var(--bg-menu-btn);
            color: var(--color-text);
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .menu-btn:hover {
            background: var(--color-primary);
            transform: scale(1.05);
        }

        /* TELA DO JOGO */
        #gameCanvas {
            background: var(--bg-screen);
            border: 2px solid var(--color-primary);
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(88, 101, 242, 0.3);
            touch-action: none; 
            max-width: 400px;
            max-height: 400px;
        }

        .light-mode #gameCanvas {
            box-shadow: 0 0 30px rgba(76, 175, 80, 0.3);
        }
        
        .game-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            height: 100vh;
            width: 100%;
            padding: 10px 0; 
        }

        .game-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-grow: 1; 
            justify-content: center;
            width: 100%;
        }
        
        .game-header {
            text-align: center;
            margin-bottom: 10px;
            color: var(--color-primary);
        }
        .game-stats {
            display: flex;
            justify-content: space-around;
            margin: 10px 0;
            font-size: 1.2rem;
            width: 100%;
            max-width: 400px;
            color: var(--color-text);
        }
        .game-controls {
            margin-top: 5px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .control-btn {
            background: var(--bg-menu-btn);
            color: var(--color-text);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
        }


        /* BOT√ïES MOBILE (D-PAD) */
        .mobile-controls {
            display: flex; 
            justify-content: center;
            align-items: flex-end;
            width: 100%;
            padding-bottom: 10px; 
            user-select: none;
            touch-action: none;
        }
        
        .mobile-controls .dpad-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 150px; 
            height: 150px; 
            transform-origin: center center;
            transition: transform 0.1s; 
        }

        .mobile-controls .dpad {
            display: grid;
            grid-template-areas: ". up ." "left center right" ". down .";
            width: 100%;
            height: 100%;
        }
        
        .mobile-btn {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 15px;
            font-size: 1.5rem;
            border-radius: 10px;
            margin: 5px;
            touch-action: manipulation;
            box-shadow: 0 4px 0 #4350c7;
        }
        
        .light-mode .mobile-btn {
            box-shadow: 0 4px 0 #3e8e41; /* Sombra mais escura para o verde claro */
        }
        
        .mobile-btn:active {
            box-shadow: none;
            transform: translateY(4px);
        }
        
        .mobile-btn.up { grid-area: up; }
        .mobile-btn.down { grid-area: down; }
        .mobile-btn.left { grid-area: left; }
        .mobile-btn.right { grid-area: right; }
        
        /* BOT√ÉO VOLTAR */
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 10;
            background: var(--bg-menu-btn);
            color: var(--color-text);
            border: none;
        }
        
        /* OUTRAS TELAS */
        .settings-screen, .ranking-screen, .help-screen, .about-screen {
            display: none;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            position: relative;
            overflow-y: auto; 
            max-height: 90vh;
            background: var(--bg-screen);
            color: var(--color-text);
        }

        .settings-screen h3, .ranking-screen h2, .help-screen h2, .about-screen h2 {
            color: var(--color-primary);
            margin-bottom: 20px;
        }

        .ranking-list {
            list-style: none;
            padding: 0;
        }
        
        /* RANKING STYLES (Adicionado aqui para funcionar) */
        .ranking-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--color-border);
            transition: all 0.2s;
            font-size: 1.1rem;
        }
        .ranking-item:hover {
            background: rgba(var(--color-primary-rgb), 0.1);
        }
        .ranking-item.gold { color: #FFD700; }
        .ranking-item.silver { color: #C0C0C0; }
        .ranking-item.bronze { color: #CD7F32; }


        .setting-option {
            margin-bottom: 15px;
            padding: 10px;
            border-bottom: 1px solid var(--color-border);
        }
        .setting-option label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--color-subtle);
        }
        .value-display {
            color: var(--color-subtle);
        }
        
        .adjust-btn {
            background: var(--bg-menu-btn);
            color: var(--color-text);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.2s;
            flex-shrink: 0; 
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .adjust-btn:active {
            background: var(--color-primary);
        }
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .slider-container .slider {
            flex-grow: 1; 
            margin: 0;
        }

        /* TOGGLE SWITCH (para Modo Escuro/Claro) */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider-switch {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 34px;
        }
        .slider-switch:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider-switch {
            background-color: var(--color-primary);
        }
        input:focus + .slider-switch {
            box-shadow: 0 0 1px var(--color-primary);
        }
        input:checked + .slider-switch:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }
        .theme-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        @media (max-width: 768px) {
            #gameCanvas {
                width: 95vw;
                height: 95vw;
                max-width: 400px;
                max-height: 400px;
            }
            .game-screen {
                padding: 10px 0; 
            }
        }
        
        /* ==================== */
        /* ANIMA√á√ïES - BOLINHAS */
        /* ==================== */

        .bolinha {
            position: fixed;
            width: 20px;
            height: 20px;
            background: var(--color-primary);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            opacity: 0.7;
            animation: bolinha-caindo 1.5s ease-out forwards;
        }

        @keyframes bolinha-caindo {
            0% {
                transform: translateY(-100px) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) scale(0.3);
                opacity: 0;
            }
        }

        /* Efeito de transi√ß√£o entre telas */
        .tela-saindo {
            animation: tela-saindo 0.5s ease-out forwards;
        }

        .tela-entrando {
            animation: tela-entrando 0.5s ease-out forwards;
        }

        @keyframes tela-saindo {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
        }

        @keyframes tela-entrando {
            0% {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div id="menuScreen" class="menu-screen">
        <h1><i class="fas fa-gamepad"></i> SNAKE GAME</h1>
        <p style="color: var(--color-subtle);">Edi√ß√£o Especial GameLink</p>
        
        <div class="menu-buttons">
            <button class="menu-btn" id="btnStartGame">
                <i class="fas fa-play"></i> JOGAR
            </button>
            
            <button class="menu-btn" id="btnShowSettings">
                <i class="fas fa-cog"></i> CONFIGURA√á√ïES
            </button>
            
            <button class="menu-btn" id="btnShowRanking">
                <i class="fas fa-trophy"></i> RANKING
            </button>
            
            <button class="menu-btn" id="btnShowHelp">
                <i class="fas fa-question-circle"></i> AJUDA
            </button>
            
            <button class="menu-btn" id="btnShowAbout">
                <i class="fas fa-info-circle"></i> SOBRE
            </button>
        </div>
        
        <div style="margin-top: 30px; font-size: 0.9rem; color: var(--color-subtle);">
            üéÆ Use ‚Üê‚Üë‚Üì‚Üí ou WASD para mover
        </div>
    </div>
    
    <div id="gameScreen" class="game-screen">
        <button class="back-btn" id="btnBackGame">
            <i class="fas fa-arrow-left"></i> MENU
        </button>
        
        <div class="game-content"> 
            <div class="game-header">
                <h2>üêç SNAKE GAME</h2>
                <p style="color: var(--color-subtle);">Controle a cobra e coma a comida!</p>
            </div>
            
            <canvas id="gameCanvas" width="400" height="400"></canvas>
            
            <div class="game-stats">
                <div>Pontua√ß√£o: <span id="score">0</span></div>
                <div>Recorde: <span id="highScore">0</span></div>
                <div>Velocidade: <span id="speed">1x</span></div>
            </div>
            
            <div class="game-controls">
                <button class="control-btn" id="pauseBtn">
                    <i class="fas fa-pause"></i> PAUSAR
                </button>
                <button class="control-btn" id="resetBtn">
                    <i class="fas fa-redo"></i> REINICIAR
                </button>
            </div>
        </div> 
        
        <div class="mobile-controls">
            <div class="dpad-container">
                <div class="dpad">
                    <button class="mobile-btn up" onclick="handleTouchControls('up')"><i class="fas fa-arrow-up"></i></button>
                    <button class="mobile-btn left" onclick="handleTouchControls('left')"><i class="fas fa-arrow-left"></i></button>
                    <div class="mobile-center"></div>
                    <button class="mobile-btn right" onclick="handleTouchControls('right')"><i class="fas fa-arrow-right"></i></button>
                    <button class="mobile-btn down" onclick="handleTouchControls('down')"><i class="fas fa-arrow-down"></i></button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="settingsScreen" class="settings-screen">
        <button class="back-btn" id="btnBackSettings">
            <i class="fas fa-arrow-left"></i> VOLTAR
        </button>
        
        <h2><i class="fas fa-cog"></i> CONFIGURA√á√ïES</h2>

        <div class="setting-option theme-control">
            <label>Modo de Tema:</label>
            <div style="display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-moon"></i>
                <label class="switch">
                    <input type="checkbox" id="themeSwitch">
                    <span class="slider-switch"></span>
                </label>
                <i class="fas fa-sun"></i>
            </div>
        </div>
        
        <div class="setting-option">
            <label>Velocidade Inicial:</label>
            <input type="range" min="50" max="200" value="100" class="slider" id="speedSlider">
            <div id="speedValue" class="value-display">Normal</div>
        </div>
        
        <div class="setting-option">
            <label>Tamanho do Campo:</label>
            <select class="select-box" id="fieldSize">
                <option value="400">Pequeno (20x20)</option>
                <option value="500" selected>M√©dio (25x25)</option>
                <option value="600">Grande (30x30)</option>
            </select>
        </div>
        
        <div class="setting-option">
            <label>Cor da Cobra:</label>
            <select class="select-box" id="snakeColor">
                <option value="#5865F2">Roxo Gamer</option>
                <option value="#4CAF50">Verde Cl√°ssico</option>
                <option value="#FF5252">Vermelho</option>
                <option value="#FF9800">Laranja</option>
            </select>
        </div>
        
        <div class="setting-option">
            <label>Modo de Jogo:</label>
            <select class="select-box" id="gameMode">
                <option value="classic">Cl√°ssico</option>
                <option value="speed">Velocidade</option>
                <option value="walls">Com Paredes</option>
            </select>
        </div>

        <h3><i class="fas fa-mobile-alt"></i> Controles Mobile</h3>

        <div class="setting-option">
            <label>Tamanho dos Bot√µes (Escala: 50% a 300%):</label>
            <div class="slider-container">
                <button class="adjust-btn" onclick="adjustControl('controlSizeSlider', -1)">-</button>
                <input type="range" min="50" max="300" value="100" class="slider" id="controlSizeSlider">
                <button class="adjust-btn" onclick="adjustControl('controlSizeSlider', 1)">+</button>
            </div>
            <div id="controlSizeValue" class="value-display">100%</div>
        </div>

        <div class="setting-option">
            <label>Posi√ß√£o Horizontal (Esquerda/Direita) - de -100% a 100%:</label>
            <div class="slider-container">
                <button class="adjust-btn" onclick="adjustControl('controlXSlider', -1)">-</button>
                <input type="range" min="-100" max="100" value="0" class="slider" id="controlXSlider">
                <button class="adjust-btn" onclick="adjustControl('controlXSlider', 1)">+</button>
            </div>
            <div id="controlXValue" class="value-display">Centro (0%)</div>
        </div>

        <div class="setting-option">
            <label>Posi√ß√£o Vertical (Acima/Abaixo) - de -100% a 100%:</label>
            <div class="slider-container">
                <button class="adjust-btn" onclick="adjustControl('controlYSlider', -1)">-</button>
                <input type="range" min="-100" max="100" value="0" class="slider" id="controlYSlider">
                <button class="adjust-btn" onclick="adjustControl('controlYSlider', 1)">+</button>
            </div>
            <div id="controlYValue" class="value-display">Centro (0%)</div>
        </div>

        <div class="setting-option">
            <label>Opacidade (Transpar√™ncia):</label>
            <div class="slider-container">
                <button class="adjust-btn" onclick="adjustControl('controlOpacitySlider', -1)">-</button>
                <input type="range" min="20" max="100" value="100" class="slider" id="controlOpacitySlider">
                <button class="adjust-btn" onclick="adjustControl('controlOpacitySlider', 1)">+</button>
            </div>
            <div id="controlOpacityValue" class="value-display">100% (Opaco)</div>
        </div>
        
        <button class="menu-btn" id="btnSaveSettings" style="margin-top: 30px;">
            <i class="fas fa-save"></i> SALVAR CONFIGURA√á√ïES
        </button>
    </div>
    
    <div id="rankingScreen" class="ranking-screen">
        <button class="back-btn" id="btnBackRanking">
            <i class="fas fa-arrow-left"></i> VOLTAR
        </button>
        
        <h2><i class="fas fa-trophy"></i> RANKING</h2>
        
        <ul class="ranking-list" id="rankingList">
            </ul>
    </div>
    
    <div id="helpScreen" class="help-screen">
        <button class="back-btn" id="btnBackHelp">
            <i class="fas fa-arrow-left"></i> VOLTAR
        </button>
        
        <h2><i class="fas fa-question-circle"></i> AJUDA</h2>
        
        <div class="help-item">
            <strong><i class="fas fa-gamepad"></i> CONTROLES:</strong>
            <p style="color: var(--color-subtle);">‚Üê ‚Üí ‚Üë ‚Üì ou WASD para mover a cobra</p>
        </div>
        
        <div class="help-item">
            <strong><i class="fas fa-apple-alt"></i> COMIDAS:</strong>
            <p style="color: var(--color-subtle);">‚Ä¢ Frutas normais (+1 ponto)<br>
               ‚Ä¢ Fruta Gold: +5 pontos (dourada e mais rara)</p>
        </div>
        
        <div class="help-item">
            <strong><i class="fas fa-skull-crossbones"></i> GAME OVER:</strong>
            <p style="color: var(--color-subtle);">Bate na parede ou no pr√≥prio corpo</p>
        </div>
        
        <div class="help-item">
            <strong><i class="fas fa-star"></i> DICAS:</strong>
            <p style="color: var(--color-subtle);">‚Ä¢ Planeje seus movimentos<br>
               ‚Ä¢ N√£o fique encurralado<br>
               ‚Ä¢ Coma as frutas douradas para pontuar mais</p>
        </div>
    </div>
    
    <div id="aboutScreen" class="help-screen" style="display: none;">
        <button class="back-btn" id="btnBackAbout">
            <i class="fas fa-arrow-left"></i> VOLTAR
        </button>
        
        <h2><i class="fas fa-info-circle"></i> SOBRE O JOGO</h2>
        
        <div class="help-item">
            <strong>üéÆ SNAKE GAME - GameLink Edition</strong>
            <p style="color: var(--color-subtle);">Vers√£o: 1.5.0 (Novas Frutas e Ranking Corrigido)</p>
            <p style="color: var(--color-subtle);">Desenvolvido especialmente para a comunidade gamer</p>
        </div>
        
        <div class="help-item">
            <strong>üì± COMPATIBILIDADE:</strong>
            <p style="color: var(--color-subtle);">‚Ä¢ PC: Chrome, Firefox, Edge<br>
               ‚Ä¢ Mobile: Android, iOS<br>
               ‚Ä¢ Offline: Funciona sem internet</p>
        </div>
        
        <div style="text-align: center; margin-top: 20px; color: var(--color-primary);">
            <p>¬© 2024 GameLink - Todos os direitos reservados</p>
        </div>
    </div>

    <script>
        // ====================
        // FUN√á√ÉO AUXILIAR PARA CORES E SOMBRAS
        // ====================
        /**
         * Altera a tonalidade de uma cor hexadecimal (para escurecer ou clarear).
         */
        function shadeColor(color, percent) {
            let R = parseInt(color.substring(1, 3), 16);
            let G = parseInt(color.substring(3, 5), 16);
            let B = parseInt(color.substring(5, 7), 16);

            R = parseInt(R * (100 + percent) / 100);
            G = parseInt(G * (100 + percent) / 100);
            B = parseInt(B * (100 + percent) / 100);

            R = (R < 255) ? R : 255;
            G = (G < 255) ? G : 255;
            B = (B < 255) ? B : 255;

            let RR = ((R.toString(16).length == 1) ? "0" + R.toString(16) : R.toString(16));
            let GG = ((G.toString(16).length == 1) ? "0" + G.toString(16) : G.toString(16));
            let BB = ((B.toString(16).length == 1) ? "0" + B.toString(16) : B.toString(16));

            return "#" + RR + GG + BB;
        }


        // ====================
        // GERENCIAMENTO DE TEMA (Modo Escuro/Claro)
        // ====================

        const themeSwitch = document.getElementById('themeSwitch');

        function applyTheme(isLightMode) {
            if (isLightMode) {
                document.body.classList.add('light-mode');
            } else {
                document.body.classList.remove('light-mode');
            }
        }

        function toggleTheme() {
            const isLightMode = themeSwitch.checked;
            applyTheme(isLightMode);
            localStorage.setItem('snakeTheme', isLightMode ? 'light' : 'dark');
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('snakeTheme') || 'dark';
            const isLightMode = savedTheme === 'light';

            themeSwitch.checked = isLightMode;
            applyTheme(isLightMode);
        }

        // ====================
        // GERENCIAMENTO DE SONS
        // ====================

        // Note: As URLs de som foram omitidas por seguran√ßa. Use suas pr√≥prias URLs.
        function playSound(soundName) {
            // Implementa√ß√£o de som omitida
        }

        // ====================
        // ANIMA√á√ïES - BOLINHAS CAINDO
        // ====================

        function criarBolinhasCaindo(numBolinhas = 15, elementoAlvo = null) {
            for (let i = 0; i < numBolinhas; i++) {
                setTimeout(() => {
                    const bolinha = document.createElement('div');
                    bolinha.classList.add('bolinha');
                    
                    // Define cores aleat√≥rias baseadas no tema
                    const cores = [
                        'var(--color-primary)',
                        '#FF5252', 
                        '#4CAF50',
                        '#FF9800',
                        '#9C27B0'
                    ];
                    
                    // Se houver um elemento alvo, posiciona as bolinhas em rela√ß√£o a ele
                    let left = Math.random() * 100;
                    if (elementoAlvo) {
                        const rect = elementoAlvo.getBoundingClientRect();
                        // Calcula a posi√ß√£o horizontal aleat√≥ria dentro da largura do elemento
                        left = ((rect.left / window.innerWidth) * 100) + ((rect.width / window.innerWidth) * 100 * Math.random());
                    }
                    
                    bolinha.style.left = left + 'vw';
                    bolinha.style.background = cores[Math.floor(Math.random() * cores.length)];
                    bolinha.style.animationDuration = (0.8 + Math.random() * 0.7) + 's';
                    
                    // Tamanho aleat√≥rio
                    const tamanho = 10 + Math.random() * 20;
                    bolinha.style.width = tamanho + 'px';
                    bolinha.style.height = tamanho + 'px';
                    
                    document.body.appendChild(bolinha);
                    
                    // Remove a bolinha ap√≥s a anima√ß√£o
                    setTimeout(() => {
                        if (bolinha.parentNode) {
                            bolinha.parentNode.removeChild(bolinha);
                        }
                    }, 1500);
                }, i * 50); // Delay entre cada bolinha
            }
        }

        // ====================
        // FUN√á√ÉO DE TRANSI√á√ÉO ENTRE TELAS
        // ====================

        function transicionarTela(telaAtualId, novaTelaId, callback) {
            const telaAtual = document.getElementById(telaAtualId);
            const novaTela = document.getElementById(novaTelaId);
            
            if (telaAtual && telaAtual.style.display !== 'none') {
                // Se a tela atual estiver vis√≠vel, aplica a anima√ß√£o de sa√≠da
                telaAtual.classList.add('tela-saindo');
                
                setTimeout(() => {
                    // Esconde todas as telas
                    hideAllScreens();
                    
                    // Mostra a nova tela com anima√ß√£o
                    if (novaTela) {
                        novaTela.style.display = (novaTelaId === 'menuScreen' || novaTelaId === 'gameScreen') ? 'flex' : 'block';
                        novaTela.classList.add('tela-entrando');
                        
                        // Remove a classe ap√≥s anima√ß√£o de entrada
                        setTimeout(() => {
                            novaTela.classList.remove('tela-entrando');
                        }, 500);
                    }
                    
                    // Executa callback se existir
                    if (callback) callback();
                    
                    // Remove a classe da tela antiga
                    telaAtual.classList.remove('tela-saindo');
                }, 300); // 300ms de atraso para dar tempo da anima√ß√£o sair
            } else {
                // Se n√£o houver tela atual vis√≠vel, apenas mostra a nova
                hideAllScreens();
                if (novaTela) {
                    novaTela.style.display = (novaTelaId === 'menuScreen' || novaTelaId === 'gameScreen') ? 'flex' : 'block';
                    novaTela.classList.add('tela-entrando');
                    
                    setTimeout(() => {
                        novaTela.classList.remove('tela-entrando');
                    }, 500);
                }
                
                if (callback) callback();
            }
        }

        // ====================
        // GERENCIAMENTO DE TELAS 
        // ====================

        function showMenu() {
            if (gameLoop) clearInterval(gameLoop);
            gameRunning = false;
            
            const currentScreen = document.querySelector('.menu-screen, .game-screen, .settings-screen, .ranking-screen, .help-screen, .about-screen');
            const currentId = currentScreen && currentScreen.style.display !== 'none' ? currentScreen.id : '';

            transicionarTela(currentId, 'menuScreen');
        }

        function startGame() {
            transicionarTela('menuScreen', 'gameScreen', initGame);
        }

        function showSettings() {
            transicionarTela('menuScreen', 'settingsScreen', loadSettings);
        }

        function showRanking() {
            transicionarTela('menuScreen', 'rankingScreen', loadRanking); 
        }

        function showHelp() {
            transicionarTela('menuScreen', 'helpScreen');
        }

        function showAbout() {
            transicionarTela('menuScreen', 'aboutScreen');
        }
        
        // FUN√á√ÉO ATUALIZADA
        function hideAllScreens() {
            const screens = [
                'menuScreen', 'gameScreen', 'settingsScreen',
                'rankingScreen', 'helpScreen', 'aboutScreen'
            ];

            screens.forEach(screen => {
                const elemento = document.getElementById(screen);
                if (elemento) {
                    elemento.style.display = 'none';
                    elemento.classList.remove('tela-saindo', 'tela-entrando');
                }
            });
        }


        // ====================
        // CONFIGURA√á√ïES 
        // ====================
        
        function getDefaultSettings() {
            return {
                speed: 100,
                fieldSize: 400,
                snakeColor: '#5865F2',
                gameMode: 'classic',
                controlSize: 100,
                controlX: 0,
                controlY: 0,
                controlOpacity: 100
            };
        }

        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('snakeSettings')) || getDefaultSettings();

            applyControlStyles();

            document.getElementById('speedSlider').value = settings.speed;
            document.getElementById('fieldSize').value = settings.fieldSize;
            document.getElementById('snakeColor').value = settings.snakeColor;
            document.getElementById('gameMode').value = settings.gameMode;
            updateSpeedValue(settings.speed);

            document.getElementById('controlSizeSlider').value = settings.controlSize;
            document.getElementById('controlXSlider').value = settings.controlX;
            document.getElementById('controlYSlider').value = settings.controlY;
            document.getElementById('controlOpacitySlider').value = settings.controlOpacity;

            updateControlSizeValue(settings.controlSize);
            updateControlXValue(settings.controlX);
            updateControlYValue(settings.controlY);
            updateControlOpacityValue(settings.controlOpacity);

            ['speedSlider', 'controlSizeSlider', 'controlXSlider', 'controlYSlider', 'controlOpacitySlider'].forEach(id => {
                const slider = document.getElementById(id);
                if (slider && !slider.hasListener) {
                    slider.addEventListener('input', function() {
                        if (id === 'speedSlider') updateSpeedValue(this.value);
                        if (id === 'controlSizeSlider') updateControlSizeValue(this.value);
                        if (id === 'controlXSlider') updateControlXValue(this.value);
                        if (id === 'controlYSlider') updateControlYValue(this.value);
                        if (id === 'controlOpacitySlider') updateControlOpacityValue(this.value);
                    });
                    slider.hasListener = true;
                }
            });
            applyControlStyles();
        }


        function adjustControl(sliderId, step) {
            const slider = document.getElementById(sliderId);
            if (slider) {
                let currentValue = parseInt(slider.value);
                let newValue = currentValue + step;

                newValue = Math.max(slider.min, Math.min(slider.max, newValue));

                slider.value = newValue;

                const event = new Event('input');
                slider.dispatchEvent(event);
            }
        }


        function applyControlStyles() {
            const settings = JSON.parse(localStorage.getItem('snakeSettings')) || getDefaultSettings();
            const dpadContainer = document.querySelector('.dpad-container');

            if (dpadContainer) {
                const scale = settings.controlSize / 100;
                const translateX = settings.controlX;
                const translateY = settings.controlY;

                dpadContainer.style.transform = `scale(${scale}) translate(${translateX}%, ${translateY}%)`;
                dpadContainer.style.opacity = settings.controlOpacity / 100;
            }
        }

        function updateSpeedValue(value) {
            const speeds = {
                50: 'Muito R√°pido',
                75: 'R√°pido',
                100: 'Normal',
                150: 'Lento',
                200: 'Muito Lento'
            };

            document.getElementById('speedValue').textContent =
                speeds[value] || 'Normal';
        }

        function updateControlSizeValue(value) {
            document.getElementById('controlSizeValue').textContent = `${value}%`;
        }
        function updateControlXValue(value) {
            document.getElementById('controlXValue').textContent = `${value}% (${value < 0 ? 'Esquerda' : value > 0 ? 'Direita' : 'Centro'})`;
        }
        function updateControlYValue(value) {
            document.getElementById('controlYValue').textContent = `${value}% (${value < 0 ? 'Acima' : value > 0 ? 'Abaixo' : 'Centro'})`;
        }
        function updateControlOpacityValue(value) {
            document.getElementById('controlOpacityValue').textContent = `${value}% (${value == 100 ? 'Opaco' : 'Transparente'})`;
        }

        function saveSettings() {
            const settings = {
                speed: parseInt(document.getElementById('speedSlider').value),
                fieldSize: parseInt(document.getElementById('fieldSize').value),
                snakeColor: document.getElementById('snakeColor').value,
                gameMode: document.getElementById('gameMode').value,
                controlSize: parseInt(document.getElementById('controlSizeSlider').value),
                controlX: parseInt(document.getElementById('controlXSlider').value),
                controlY: parseInt(document.getElementById('controlYSlider').value),
                controlOpacity: parseInt(document.getElementById('controlOpacitySlider').value)
            };

            localStorage.setItem('snakeSettings', JSON.stringify(settings));
            alert('Configura√ß√µes salvas! Reinicie o jogo para aplicar.');
            // Ap√≥s salvar, transiciona de volta para o menu
            transicionarTela('settingsScreen', 'menuScreen', showMenu);
        }
        
        // ====================
        // GERENCIAMENTO DE RANKING (ATUALIZADO)
        // ====================

        function getRanking() {
            const ranking = localStorage.getItem('snakeRanking');
            return ranking ? JSON.parse(ranking) : [];
        }

        function saveRanking(ranking) {
            localStorage.setItem('snakeRanking', JSON.stringify(ranking));
        }

        /**
         * Adiciona ou atualiza a pontua√ß√£o de um jogador, garantindo que
         * apenas o recorde de cada nome seja mantido.
         */
        function updateRanking(name, score) {
            let ranking = getRanking();

            // 1. Encontra se o jogador j√° existe
            const existingPlayerIndex = ranking.findIndex(player => player.name.toUpperCase() === name.toUpperCase());

            if (existingPlayerIndex !== -1) {
                // 2. Se o jogador existe, verifica se a nova pontua√ß√£o √© um recorde
                if (score > ranking[existingPlayerIndex].score) {
                    ranking[existingPlayerIndex].score = score; // Atualiza a pontua√ß√£o
                }
            } else {
                // 3. Se n√£o existe, adiciona o novo jogador
                ranking.push({ name: name, score: score });
            }

            // 4. Ordena o ranking (do maior score para o menor)
            ranking.sort((a, b) => b.score - a.score);

            // 5. Salva o ranking (limitando aos 10 melhores, por exemplo)
            saveRanking(ranking.slice(0, 10));
        }

        function loadRanking() {
            const rankingList = document.getElementById('rankingList');
            const ranking = getRanking();
            
            rankingList.innerHTML = ''; // Limpa a lista atual

            if (ranking.length === 0) {
                rankingList.innerHTML = '<li style="text-align: center; color: var(--color-subtle);">Nenhum recorde registrado ainda.</li>';
                return;
            }

            ranking.forEach((player, index) => {
                const listItem = document.createElement('li');
                
                // Define classes para destaque dos primeiros lugares
                let rankClass = '';
                if (index === 0) rankClass = 'gold';
                else if (index === 1) rankClass = 'silver';
                else if (index === 2) rankClass = 'bronze';
                
                listItem.className = `ranking-item ${rankClass}`;
                
                let icon = '';
                if (index === 0) icon = '<i class="fas fa-crown"></i>';
                else if (index === 1) icon = '<i class="fas fa-medal"></i>';
                else if (index === 2) icon = '<i class="fas fa-medal" style="color: #CD7F32;"></i>'; // Bronze
                else icon = `${index + 1}.`;

                listItem.innerHTML = `
                    <div style="font-weight: bold; width: 40px; text-align: left;">${icon}</div>
                    <div style="flex-grow: 1;">${player.name}</div>
                    <div style="font-weight: bold; color: var(--color-primary);">${player.score} pts</div>
                `;

                rankingList.appendChild(listItem);
            });
        }


        // ====================
        // JOGO (Snake) 
        // ====================

        let canvas, ctx;
        let snake = [];
        let food = {};
        let direction = 'right';
        let nextDirection = 'right';
        let score = 0;
        let highScore = 0;
        let gameSpeed = 100;
        let gameRunning = true;
        let gameLoop;
        let gameTick = 0; 
        
        // TIPOS DE FRUTAS (ATUALIZADO com melancia, cereja, abacaxi, lim√£o e morango)
        const FRUIT_TYPES = ['apple', 'watermelon', 'banana', 'orange', 'cherry', 'pineapple', 'grape', 'lemon', 'strawberry']; 

        function initGame() {
            const settings = JSON.parse(localStorage.getItem('snakeSettings')) || getDefaultSettings();

            applyControlStyles();

            canvas = document.getElementById('gameCanvas');
            canvas.width = settings.fieldSize;
            canvas.height = settings.fieldSize;
            ctx = canvas.getContext('2d');

            snake = [{ x: 10, y: 10 }];
            direction = 'right';
            nextDirection = 'right';
            score = 0;
            gameSpeed = settings.speed;
            gameRunning = true;
            gameTick = 0;

            highScore = localStorage.getItem('snakeHighScore') || 0;
            document.getElementById('highScore').textContent = highScore;
            document.getElementById('score').textContent = score;
            document.getElementById('speed').textContent = (1000 / gameSpeed).toFixed(1) + 'x';

            generateFood();
            draw();

            if (gameLoop) clearInterval(gameLoop);
            gameLoop = setInterval(update, gameSpeed);

            document.removeEventListener('keydown', handleKeyPress);
            document.addEventListener('keydown', handleKeyPress);
        }
        
        // Fun√ß√£o para gerar a comida (agora com variedade e b√¥nus)
        function generateFood() {
            const gridSize = 20;
            const max = canvas.width / gridSize;
            
            // Escolhe se √© uma fruta normal (80%) ou especial/gold (20%)
            const isSpecial = Math.random() > 0.8;
            
            food = {
                x: Math.floor(Math.random() * max),
                y: Math.floor(Math.random() * max),
                type: isSpecial ? 'special' : 'normal',
                // Se for normal, escolhe um tipo aleat√≥rio de fruta, se especial √© 'gold'
                fruitType: isSpecial ? 'gold' : FRUIT_TYPES[Math.floor(Math.random() * FRUIT_TYPES.length)]
            };
        }

        // Fun√ß√£o principal de desenho (com cobra arredondada, onda e frutas detalhadas)
        function draw() {
            // 1. Desenha o fundo
            ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--bg-screen');
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Pega a cor base da cobra
            const baseColor = document.getElementById('snakeColor').value || '#5865F2';
            const darkColor = shadeColor(baseColor, -20);
            const segmentSize = 20;
            
            // VARI√ÅVEIS PARA ONDA (Seno)
            const amplitude = 1.5; // Altura m√°xima do deslocamento (em pixels)
            const frequency = 0.5; // Densidade da onda (quanto menor, mais longa)
            const speed = 0.2;   // Velocidade com que a onda se move
            
            // Fun√ß√£o auxiliar para desenhar ret√¢ngulo arredondado
            const drawRoundedRect = (color, rectX, rectY, width, height, r) => {
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.moveTo(rectX + r, rectY);
                ctx.lineTo(rectX + width - r, rectY);
                ctx.arcTo(rectX + width, rectY, rectX + width, rectY + r, r);
                ctx.lineTo(rectX + width, rectY + height - r);
                ctx.arcTo(rectX + width, rectY + height, rectX + width - r, rectX + height, r);
                ctx.lineTo(rectX + r, rectY + height);
                ctx.arcTo(rectX, rectY + height, rectX, rectY + height - r, r);
                ctx.lineTo(rectX, rectY + r);
                ctx.arcTo(rectX, rectY, rectX + r, rectY, r);
                ctx.closePath();
                ctx.fill();
            };

            // --- Desenho da Cobra Arredondada e com Efeito de Onda ---
            snake.forEach((segment, index) => {
                const x = segment.x * segmentSize;
                let y = segment.y * segmentSize;
                const radius = 3; 
                
                // CALCULA O DESLOCAMENTO VERTICAL (APENAS PARA O CORPO)
                let offsetY = 0;
                if (index > 0) {
                    // A fase da onda depende do tempo (gameTick) e da posi√ß√£o no corpo (index)
                    const angle = gameTick * speed + index * frequency;
                    offsetY = amplitude * Math.sin(angle);
                    y += offsetY; // Aplica o deslocamento ao eixo Y
                }
                
                // Corpo
                if (index > 0) {
                    // Desenha a borda do segmento (cor mais escura, arredondada)
                    drawRoundedRect(darkColor, x, y, segmentSize, segmentSize, radius);

                    // Desenha o corpo interno (cor base, ligeiramente menor)
                    drawRoundedRect(baseColor, x + 2, y + 2, segmentSize - 4, segmentSize - 4, radius);
                } 
                // Cabe√ßa (Formato mais distinto - SEM DESLOCAMENTO DE ONDA)
                else {
                    ctx.fillStyle = baseColor;
                    
                    // Desenha um quadrado/ret√¢ngulo base para a cabe√ßa
                    ctx.fillRect(x, y, segmentSize, segmentSize);

                    // Olhos (mantidos para distinguir a dire√ß√£o)
                    ctx.fillStyle = 'black';
                    if (direction === 'right') {
                        ctx.fillRect(x + 13, y + 3, 2, 2);
                        ctx.fillRect(x + 13, y + 13, 2, 2);
                    } else if (direction === 'left') {
                        ctx.fillRect(x + 5, y + 3, 2, 2);
                        ctx.fillRect(x + 5, y + 13, 2, 2);
                    } else if (direction === 'up') {
                        ctx.fillRect(x + 3, y + 5, 2, 2);
                        ctx.fillRect(x + 15, y + 5, 2, 2);
                    } else if (direction === 'down') {
                        ctx.fillRect(x + 3, y + 15, 2, 2);
                        ctx.fillRect(x + 15, y + 15, 2, 2);
                    }
                }
            });

            // --- Desenho das Frutas com Formato Real ---
            const foodX = food.x * segmentSize + segmentSize / 2;
            const foodY = food.y * segmentSize + segmentSize / 2;
            const radiusFood = 8;
            let finalColor, darkOutlineColor;
            let isRound = true; // A maioria das frutas √© redonda

            // 1. Define as cores baseadas no tipo de fruta
            switch (food.fruitType) {
                case 'apple':
                case 'orange':
                    finalColor = food.fruitType === 'apple' ? '#FF3B30' : '#FF9800';
                    darkOutlineColor = shadeColor(finalColor, -25);
                    break;
                case 'banana':
                    finalColor = '#FFD930';
                    darkOutlineColor = shadeColor(finalColor, -25);
                    isRound = false; // Formato curvado
                    break;
                case 'grape':
                    finalColor = '#9C27B0';
                    darkOutlineColor = shadeColor(finalColor, -25);
                    isRound = false; // Formato de cacho
                    break;
                case 'watermelon':
                    finalColor = '#50C878'; // Verde melancia
                    darkOutlineColor = '#3A9655'; // Borda escura
                    isRound = false; // Formato de meia lua
                    break;
                case 'cherry':
                    finalColor = '#DC143C'; // Vermelho cereja
                    darkOutlineColor = shadeColor(finalColor, -25);
                    isRound = false; // Formato de cacho
                    break;
                case 'pineapple':
                    finalColor = '#FFC300'; // Amarelo abacaxi
                    darkOutlineColor = '#FFA500'; // Laranja para textura
                    isRound = false; // Formato de abacaxi
                    break;
                case 'lemon':
                    finalColor = '#FFEA00'; // Amarelo lim√£o
                    darkOutlineColor = shadeColor(finalColor, -25);
                    break;
                case 'strawberry':
                    finalColor = '#FF4500'; // Vermelho morango
                    darkOutlineColor = shadeColor(finalColor, -25);
                    isRound = false; // Formato de morango
                    break;
                case 'gold':
                    finalColor = '#FFD700';
                    darkOutlineColor = '#C0A000';
                    break;
                default:
                    finalColor = '#FF5252';
                    darkOutlineColor = shadeColor(finalColor, -25);
            }

            // 2. Cria o Gradiente (efeito 3D)
            const gradient = ctx.createRadialGradient(
                foodX - 2, foodY - 2, 1, 
                foodX, foodY, radiusFood
            );
            gradient.addColorStop(0, shadeColor(finalColor, food.type === 'special' ? 30 : 20));
            gradient.addColorStop(1, finalColor);

            // 3. Desenha a FRUTA ESPEC√çFICA
            ctx.fillStyle = gradient;
            ctx.strokeStyle = darkOutlineColor;
            ctx.lineWidth = 1.5;

            ctx.beginPath();
            
            // --- Desenhos customizados por tipo ---
            switch (food.fruitType) {
                case 'banana':
                    // Simula o formato de banana (ret√¢ngulo curvado)
                    ctx.moveTo(foodX - 8, foodY - 8);
                    ctx.bezierCurveTo(foodX - 10, foodY - 15, foodX + 10, foodY - 15, foodX + 8, foodY - 8);
                    ctx.lineTo(foodX + 5, foodY + 8);
                    ctx.bezierCurveTo(foodX + 5, foodY + 15, foodX - 5, foodY + 15, foodX - 8, foodY + 8);
                    ctx.closePath();
                    // Sem talo
                    break;
                
                case 'watermelon':
                    // Formato de fatia
                    ctx.arc(foodX, foodY, radiusFood, Math.PI, 0); // Meia lua
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                    // Miolo vermelho (interior)
                    ctx.fillStyle = shadeColor('#FF3B30', 20); // Vermelho mais claro
                    ctx.beginPath();
                    ctx.arc(foodX, foodY, radiusFood - 3, Math.PI, 0);
                    ctx.closePath();
                    ctx.fill();
                    // Sementes pretas
                    ctx.fillStyle = 'black';
                    ctx.fillRect(foodX - 4, foodY - 3, 1, 1);
                    ctx.fillRect(foodX + 3, foodY - 3, 1, 1);
                    ctx.fillRect(foodX - 0.5, foodY - 5, 1, 1);
                    break;

                case 'cherry':
                    // Desenha duas cerejas
                    ctx.arc(foodX - 4, foodY + 2, radiusFood / 2, 0, Math.PI * 2);
                    ctx.moveTo(foodX + 6, foodY + 2);
                    ctx.arc(foodX + 4, foodY + 2, radiusFood / 2, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();
                    // Desenha o cabinho (Talo)
                    ctx.strokeStyle = '#3A9655'; // Verde
                    ctx.lineWidth = 1.5;
                    ctx.beginPath();
                    ctx.moveTo(foodX - 4, foodY + 2 - radiusFood / 2);
                    ctx.lineTo(foodX - 8, foodY - 8);
                    ctx.lineTo(foodX + 8, foodY - 8);
                    ctx.lineTo(foodX + 4, foodY + 2 - radiusFood / 2);
                    ctx.stroke();
                    break;

                case 'pineapple':
                    // Formato de oval ligeiramente pontudo
                    ctx.ellipse(foodX, foodY + 3, radiusFood - 1, radiusFood + 3, 0, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();
                    // Coroa verde
                    ctx.fillStyle = '#4CAF50';
                    ctx.fillRect(foodX - 3, foodY - 10, 6, 8);
                    // Adiciona textura (linhas horizontais escuras)
                    ctx.strokeStyle = darkOutlineColor;
                    ctx.lineWidth = 0.5;
                    ctx.beginPath();
                    ctx.moveTo(foodX - 6, foodY + 1);
                    ctx.lineTo(foodX + 6, foodY + 1);
                    ctx.moveTo(foodX - 6, foodY + 5);
                    ctx.lineTo(foodX + 6, foodY + 5);
                    ctx.stroke();
                    break;

                case 'strawberry':
                    // Formato de tri√¢ngulo arredondado (cora√ß√£o)
                    ctx.moveTo(foodX, foodY - radiusFood); // Topo
                    ctx.lineTo(foodX + radiusFood, foodY + radiusFood / 2);
                    ctx.lineTo(foodX, foodY + radiusFood); // Base
                    ctx.lineTo(foodX - radiusFood, foodY + radiusFood / 2);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                    // Folhas verdes
                    ctx.fillStyle = '#4CAF50';
                    ctx.fillRect(foodX - 5, foodY - 9, 10, 4);
                    // Sementes amarelas
                    ctx.fillStyle = '#FFEB3B';
                    ctx.fillRect(foodX - 4, foodY + 0, 1, 1);
                    ctx.fillRect(foodX + 3, foodY + 2, 1, 1);
                    break;
                
                case 'grape':
                    // Desenha v√°rias bolinhas roxas
                    ctx.fillStyle = finalColor;
                    const grapeRadius = 2.5;
                    const cluster = [
                        {x: -2, y: -7}, {x: 2, y: -7},
                        {x: -4, y: -4}, {x: 0, y: -4}, {x: 4, y: -4},
                        {x: -2, y: -1}, {x: 2, y: -1},
                        {x: -4, y: 2}, {x: 0, y: 2}, {x: 4, y: 2}
                    ];
                    
                    cluster.forEach(p => {
                        ctx.beginPath();
                        ctx.arc(foodX + p.x, foodY + p.y, grapeRadius, 0, Math.PI * 2);
                        ctx.fill();
                    });

                    // Talo
                    ctx.strokeStyle = '#5A4A3A'; 
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(foodX, foodY - 8);
                    ctx.lineTo(foodX, foodY - 12);
                    ctx.stroke();
                    break;

                default:
                    // Desenho Padr√£o (Apple, Orange, Lemon, Gold)
                    ctx.arc(foodX, foodY, radiusFood, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();

                    // Adiciona um pequeno talo
                    if (food.fruitType !== 'gold') {
                        ctx.strokeStyle = '#5A4A3A'; // Marrom
                        ctx.lineWidth = 1;
                        ctx.beginPath();
                        ctx.moveTo(foodX, foodY - radiusFood);
                        ctx.lineTo(foodX + 2, foodY - radiusFood - 3);
                        ctx.stroke(); 
                    }
                    
                    // Se for lim√£o, adicione a folha
                    if (food.fruitType === 'lemon') {
                        ctx.fillStyle = '#4CAF50';
                        ctx.beginPath();
                        ctx.ellipse(foodX + 4, foodY - radiusFood - 4, 3, 2, 10 * Math.PI / 180, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    
                    ctx.strokeStyle = darkOutlineColor; 
                    ctx.lineWidth = 1.5;
                    break;
            }

            // 4. Adiciona um pequeno brilho branco no canto (Apenas para redondos)
            if (food.fruitType !== 'watermelon' && food.fruitType !== 'cherry' && food.fruitType !== 'pineapple' && food.fruitType !== 'grape' && food.fruitType !== 'strawberry') {
                 ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
                 ctx.beginPath();
                 ctx.arc(foodX - 3, foodY - 3, 1.5, 0, Math.PI * 2);
                 ctx.fill();
            }
        }


        function update() {
            if (!gameRunning) return;

            direction = nextDirection;
            const head = { ...snake[0] };

            switch (direction) {
                case 'up': head.y--; break;
                case 'down': head.y++; break;
                case 'left': head.x--; break;
                case 'right': head.x++; break;
            }

            const max = canvas.width / 20;
            const settings = JSON.parse(localStorage.getItem('snakeSettings')) || getDefaultSettings();

            if (settings.gameMode !== 'walls') {
                if (head.x < 0) head.x = max - 1;
                if (head.x >= max) head.x = 0;
                if (head.y < 0) head.y = max - 1;
                if (head.y >= max) head.y = 0;
            } else {
                if (head.x < 0 || head.x >= max || head.y < 0 || head.y >= max) {
                    gameOver();
                    return;
                }
            }

            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    gameOver();
                    return;
                }
            }

            snake.unshift(head);

            if (head.x === food.x && head.y === food.y) {
                playSound('eatFood');

                score += food.type === 'special' ? 5 : 1;
                document.getElementById('score').textContent = score;
                generateFood();

                if (score > highScore) {
                    highScore = score;
                    localStorage.setItem('snakeHighScore', highScore);
                    document.getElementById('highScore').textContent = highScore;
                }
            } else {
                snake.pop();
            }

            // ATUALIZA O CONTADOR DE QUADROS PARA O EFEITO DE ONDA
            gameTick++; 

            draw();
        }

        function handleKeyPress(e) {
            if (!gameRunning) return;
            switch (e.key) {
                case 'ArrowUp': case 'w': if (direction !== 'down') nextDirection = 'up'; break;
                case 'ArrowDown': case 's': if (direction !== 'up') nextDirection = 'down'; break;
                case 'ArrowLeft': case 'a': if (direction !== 'right') nextDirection = 'left'; break;
                case 'ArrowRight': case 'd': if (direction !== 'left') nextDirection = 'right'; break;
                case ' ': togglePause(); break;
            }
        }

        function handleTouchControls(touchDirection) {
            if (!gameRunning) return;
            switch (touchDirection) {
                case 'up': if (direction !== 'down') nextDirection = 'up'; break;
                case 'down': if (direction !== 'up') nextDirection = 'down'; break;
                case 'left': if (direction !== 'right') nextDirection = 'left'; break;
                case 'right': if (direction !== 'left') nextDirection = 'right'; break;
            }
        }

        function togglePause() {
            gameRunning = !gameRunning;
            const btn = document.getElementById('pauseBtn');
            if (gameRunning) {
                btn.innerHTML = '<i class="fas fa-pause"></i> PAUSAR';
                gameLoop = setInterval(update, gameSpeed);
            } else {
                btn.innerHTML = '<i class="fas fa-play"></i> RETOMAR';
                clearInterval(gameLoop);
            }
        }

        function resetGame() {
            clearInterval(gameLoop);
            initGame();
        }

        function gameOver() {
            playSound('gameOver');

            gameRunning = false;
            clearInterval(gameLoop);

            // Se a pontua√ß√£o for maior que zero, solicita o nome e atualiza o ranking
            if (score > 0) {
                const playerName = prompt(`Game Over! Pontua√ß√£o: ${score}\n\nParab√©ns! Digite seu nome (m√°x. 10 caracteres) para o Ranking:`, "Jogador").substring(0, 10);
                if (playerName) {
                    updateRanking(playerName, score); // CHAMA A FUN√á√ÉO DE ATUALIZA√á√ÉO
                }
            }

            setTimeout(() => {
                if (confirm(`Game Over! Pontua√ß√£o: ${score}\n\nJogar novamente?`)) {
                    resetGame();
                } else {
                    // Retorna ao menu principal com anima√ß√£o
                    transicionarTela('gameScreen', 'menuScreen', showMenu);
                }
            }, 500);
        }

        // ====================
        // LISTENERS GERAIS 
        // ====================

        function setupEventListeners() {
            document.getElementById('themeSwitch').addEventListener('change', toggleTheme);
            
            // Bot√µes do Menu com anima√ß√µes
            document.getElementById('btnStartGame').addEventListener('click', function() {
                criarBolinhasCaindo(20, this);
                setTimeout(() => {
                    transicionarTela('menuScreen', 'gameScreen', initGame);
                }, 300);
            });
            
            document.getElementById('btnShowSettings').addEventListener('click', function() {
                criarBolinhasCaindo(15, this);
                setTimeout(() => {
                    transicionarTela('menuScreen', 'settingsScreen', loadSettings);
                }, 300);
            });
            
            document.getElementById('btnShowRanking').addEventListener('click', function() {
                criarBolinhasCaindo(15, this);
                setTimeout(() => {
                    transicionarTela('menuScreen', 'rankingScreen', loadRanking);
                }, 300);
            });
            
            document.getElementById('btnShowHelp').addEventListener('click', function() {
                criarBolinhasCaindo(15, this);
                setTimeout(() => {
                    transicionarTela('menuScreen', 'helpScreen');
                }, 300);
            });
            
            document.getElementById('btnShowAbout').addEventListener('click', function() {
                criarBolinhasCaindo(15, this);
                setTimeout(() => {
                    transicionarTela('menuScreen', 'aboutScreen');
                }, 300);
            });
            
            // Bot√µes Voltar com anima√ß√µes
            document.getElementById('btnBackGame').addEventListener('click', function() {
                criarBolinhasCaindo(15, this);
                setTimeout(() => {
                    transicionarTela('gameScreen', 'menuScreen', showMenu);
                }, 300);
            });
            
            document.getElementById('btnBackSettings').addEventListener('click', function() {
                criarBolinhasCaindo(15, this);
                setTimeout(() => {
                    transicionarTela('settingsScreen', 'menuScreen', showMenu);
                }, 300);
            });
            
            document.getElementById('btnBackRanking').addEventListener('click', function() {
                criarBolinhasCaindo(15, this);
                setTimeout(() => {
                    transicionarTela('rankingScreen', 'menuScreen', showMenu);
                }, 300);
            });
            
            document.getElementById('btnBackHelp').addEventListener('click', function() {
                criarBolinhasCaindo(15, this);
                setTimeout(() => {
                    transicionarTela('helpScreen', 'menuScreen', showMenu);
                }, 300);
            });
            
            document.getElementById('btnBackAbout').addEventListener('click', function() {
                criarBolinhasCaindo(15, this);
                setTimeout(() => {
                    transicionarTela('aboutScreen', 'menuScreen', showMenu);
                }, 300);
            });
            
            // Bot√µes do jogo
            document.getElementById('pauseBtn').addEventListener('click', togglePause);
            document.getElementById('resetBtn').addEventListener('click', resetGame);
            document.getElementById('btnSaveSettings').addEventListener('click', function() {
                criarBolinhasCaindo(10, this);
                // A fun√ß√£o saveSettings agora faz a transi√ß√£o de volta para o menu
                setTimeout(() => {
                    saveSettings(); 
                }, 200);
            });
        }

        // Inicializa√ß√£o
        loadTheme();
        setupEventListeners();
        // Garante que a tela inicial seja exibida sem anima√ß√£o de sa√≠da na primeira carga
        hideAllScreens();
        document.getElementById('menuScreen').style.display = 'flex';
    </script>
</body>
</html>
